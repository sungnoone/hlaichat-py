import{_ as P,r as A,j as C,o as b,a as s,b as R,c as I,w as e,d as S,e as a,f as d,l as x,g as p,t as _}from"./index-a1ba2a77.js";import{A as N}from"./AdminLayout-918e61dc.js";const w={name:"Logs",components:{AdminLayout:N},setup(){const E=A([]),o=A(!1),r=C({username:"",action:""}),t=C({page:1,totalPages:1,totalItems:0,itemsPerPage:15}),U=A([{title:"使用者",key:"username",width:"25%"},{title:"操作類型",key:"action",width:"15%"},{title:"詳細資訊",key:"details",width:"35%"},{title:"時間",key:"timestamp",width:"25%"}]),y=[{title:"所有操作",value:""},{title:"登入",value:"LOGIN"},{title:"登出",value:"LOGOUT"},{title:"建立使用者",value:"CREATE_USER"},{title:"更新使用者",value:"UPDATE_USER"},{title:"刪除使用者",value:"DELETE_USER"},{title:"建立群組",value:"CREATE_GROUP"},{title:"更新群組",value:"UPDATE_GROUP"},{title:"刪除群組",value:"DELETE_GROUP"},{title:"建立聊天連結",value:"CREATE_CHAT_LINK"},{title:"更新聊天連結",value:"UPDATE_CHAT_LINK"},{title:"刪除聊天連結",value:"DELETE_CHAT_LINK"},{title:"使用聊天連結",value:"USE_CHAT_LINK"},{title:"發送聊天訊息",value:"SEND_CHAT_MESSAGE"},{title:"更新 AD 設定",value:"UPDATE_AD_CONFIG"}],c=async(n=null)=>{o.value=!0,(n==null||n==="")&&(n=1),t.page=n;try{const i={page:t.page,page_size:t.itemsPerPage};r.username&&r.username.trim()&&(i.username=r.username.trim()),r.action&&r.action.trim()&&(i.action=r.action.trim());const m=await S.get("/api/logs",{params:i});m.data.success&&(E.value=m.data.items,t.totalPages=m.data.total_pages,t.totalItems=m.data.total)}catch(i){console.error("獲取操作紀錄失敗:",i)}finally{o.value=!1}},u=()=>{r.username="",r.action="",t.page=1,c(1)},g=n=>({LOGIN:"success",LOGOUT:"error",CREATE_USER:"primary",UPDATE_USER:"info",DELETE_USER:"error",CREATE_GROUP:"primary",UPDATE_GROUP:"info",DELETE_GROUP:"error",CREATE_CHAT_LINK:"primary",UPDATE_CHAT_LINK:"info",DELETE_CHAT_LINK:"error",USE_CHAT_LINK:"secondary",SEND_CHAT_MESSAGE:"secondary",UPDATE_AD_CONFIG:"warning"})[n]||"secondary",f=n=>n?n.split(" ").map(i=>i.charAt(0)).join("").toUpperCase().substr(0,2):"?",v=n=>{const i=new Date(n);return new Intl.DateTimeFormat("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(i)},T=()=>{t.page=1,c(1)};return b(()=>{c()}),{logs:E,loading:o,search:r,pagination:t,headers:U,actionTypes:y,fetchLogs:c,resetSearch:u,getActionColor:g,getUserInitials:f,formatDateTime:v,onActionChange:T}}},G={class:"d-flex align-center"},O={class:"text-white"},V={class:"text-caption text-grey"},k={class:"d-flex justify-center pt-4 pb-3"};function K(E,o,r,t,U,y){const c=s("v-col"),u=s("v-row"),g=s("v-text-field"),f=s("v-select"),v=s("v-btn"),T=s("v-card-text"),n=s("v-card"),i=s("v-avatar"),m=s("v-chip"),h=s("v-data-table"),L=s("v-pagination"),D=s("AdminLayout");return R(),I(D,null,{default:e(()=>[a(u,null,{default:e(()=>[a(c,{cols:"12"},{default:e(()=>o[3]||(o[3]=[d("h1",{class:"text-h4 mb-6"},"操作紀錄",-1)])),_:1})]),_:1}),a(n,{class:"mb-4"},{default:e(()=>[a(T,null,{default:e(()=>[a(u,null,{default:e(()=>[a(c,{cols:"12",md:"4"},{default:e(()=>[a(g,{modelValue:t.search.username,"onUpdate:modelValue":o[0]||(o[0]=l=>t.search.username=l),label:"使用者名稱","prepend-inner-icon":"mdi-account",variant:"outlined",density:"compact","hide-details":"",class:"mb-3 mb-md-0",onKeyup:x(t.fetchLogs,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),a(c,{cols:"12",md:"4"},{default:e(()=>[a(f,{modelValue:t.search.action,"onUpdate:modelValue":[o[1]||(o[1]=l=>t.search.action=l),t.onActionChange],label:"操作類型",items:t.actionTypes,"item-title":"title","item-value":"value",variant:"outlined",density:"compact","hide-details":"",class:"mb-3 mb-md-0"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(c,{cols:"12",md:"2"},{default:e(()=>[a(v,{color:"primary",variant:"tonal",block:"",onClick:t.fetchLogs},{default:e(()=>o[4]||(o[4]=[p(" 搜尋 ")])),_:1},8,["onClick"])]),_:1}),a(c,{cols:"12",md:"2"},{default:e(()=>[a(v,{color:"secondary",variant:"tonal",block:"",onClick:t.resetSearch},{default:e(()=>o[5]||(o[5]=[p(" 重設 ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1}),a(n,null,{default:e(()=>[a(h,{headers:t.headers,items:t.logs,loading:t.loading,"items-per-page":15,class:"elevation-1"},{"item.username":e(({item:l})=>[d("div",G,[a(i,{size:"32",color:"primary",class:"mr-2"},{default:e(()=>[d("span",O,_(t.getUserInitials(l.user_full_name)),1)]),_:2},1024),d("div",null,[d("div",null,_(l.user_full_name),1),d("div",V,_(l.user_username),1)])])]),"item.action":e(({item:l})=>[a(m,{color:t.getActionColor(l.action),size:"small"},{default:e(()=>[p(_(l.action),1)]),_:2},1032,["color"])]),"item.timestamp":e(({item:l})=>[p(_(t.formatDateTime(l.timestamp)),1)]),_:1},8,["headers","items","loading"]),d("div",k,[a(L,{modelValue:t.pagination.page,"onUpdate:modelValue":[o[2]||(o[2]=l=>t.pagination.page=l),t.fetchLogs],length:t.pagination.totalPages,"total-visible":7},null,8,["modelValue","length","onUpdate:modelValue"])])]),_:1})]),_:1})}const j=P(w,[["render",K]]);export{j as default};
