import{_ as N,r as y,j as V,o as B,a as d,b as x,c as g,w as r,d as k,e as a,f as L,g as p,n as S,p as A,t as D}from"./index-a1ba2a77.js";import{A as M}from"./AdminLayout-918e61dc.js";const j={name:"Profile",components:{AdminLayout:M},setup(){const u=y({username:"",full_name:"",email:"",phone:"",department:"",is_ad_user:!1}),e=V({current:"",new:"",confirm:""}),f=V({profile:!1,password:!1}),o=V({show:!1,text:"",color:"success"}),w=y(null),b=y(null),c=async()=>{try{const t=await k.get("/api/auth/me");if(t.data.user){const n=t.data.user;u.value={username:n.username,full_name:n.full_name,email:n.email||"",phone:n.phone||"",department:n.department||"",is_ad_user:n.is_ad_user}}}catch(t){console.error("獲取個人資料失敗:",t),s("獲取個人資料失敗","error")}},_=async()=>{var n,m;if(u.value.is_ad_user){s("AD帳號無法修改個人資料","warning");return}const{valid:t}=await w.value.validate();if(t){f.profile=!0;try{(await k.put("/api/users/profile",{full_name:u.value.full_name,email:u.value.email,phone:u.value.phone,department:u.value.department})).data.success&&s("個人資料更新成功")}catch(i){console.error("更新個人資料失敗:",i),s(((m=(n=i.response)==null?void 0:n.data)==null?void 0:m.detail)||"更新個人資料失敗","error")}finally{f.profile=!1}}},v=async()=>{var n,m;const{valid:t}=await b.value.validate();if(t){f.password=!0;try{(await k.put("/api/users/password",{current_password:e.current,new_password:e.new})).data.success&&(s("密碼更新成功"),e.current="",e.new="",e.confirm="")}catch(i){console.error("更新密碼失敗:",i),s(((m=(n=i.response)==null?void 0:n.data)==null?void 0:m.detail)||"更新密碼失敗","error")}finally{f.password=!1}}},s=(t,n="success")=>{o.text=t,o.color=n,o.show=!0};return B(()=>{c()}),{profile:u,passwords:e,loading:f,snackbar:o,profileForm:w,passwordForm:b,updateProfile:_,updatePassword:v}}};function T(u,e,f,o,w,b){const c=d("v-col"),_=d("v-row"),v=d("v-card-title"),s=d("v-text-field"),t=d("v-spacer"),n=d("v-btn"),m=d("v-card-actions"),i=d("v-form"),U=d("v-card-text"),P=d("v-card"),C=d("v-snackbar"),F=d("AdminLayout");return x(),g(F,null,{default:r(()=>[a(_,null,{default:r(()=>[a(c,{cols:"12"},{default:r(()=>e[10]||(e[10]=[L("h1",{class:"text-h4 mb-6"},"個人設定",-1)])),_:1})]),_:1}),a(_,null,{default:r(()=>[a(c,{cols:"12",md:"8",lg:"6"},{default:r(()=>[a(P,null,{default:r(()=>[a(v,{class:"bg-primary text-white"},{default:r(()=>e[11]||(e[11]=[p(" 個人資料 ")])),_:1}),a(U,{class:"pt-4"},{default:r(()=>[a(i,{ref:"profileForm",onSubmit:S(o.updateProfile,["prevent"])},{default:r(()=>[a(s,{modelValue:o.profile.username,"onUpdate:modelValue":e[0]||(e[0]=l=>o.profile.username=l),label:"使用者名稱",variant:"outlined",readonly:"",class:"mb-3"},null,8,["modelValue"]),a(s,{modelValue:o.profile.full_name,"onUpdate:modelValue":e[1]||(e[1]=l=>o.profile.full_name=l),label:"姓名",variant:"outlined",readonly:o.profile.is_ad_user,rules:[l=>!!l||"請輸入姓名"],class:"mb-3"},null,8,["modelValue","readonly","rules"]),a(s,{modelValue:o.profile.email,"onUpdate:modelValue":e[2]||(e[2]=l=>o.profile.email=l),label:"電子郵件",variant:"outlined",readonly:o.profile.is_ad_user,class:"mb-3"},null,8,["modelValue","readonly"]),a(s,{modelValue:o.profile.phone,"onUpdate:modelValue":e[3]||(e[3]=l=>o.profile.phone=l),label:"電話",variant:"outlined",readonly:o.profile.is_ad_user,class:"mb-3"},null,8,["modelValue","readonly"]),a(s,{modelValue:o.profile.department,"onUpdate:modelValue":e[4]||(e[4]=l=>o.profile.department=l),label:"部門",variant:"outlined",readonly:o.profile.is_ad_user,class:"mb-3"},null,8,["modelValue","readonly"]),a(m,null,{default:r(()=>[a(t),o.profile.is_ad_user?A("",!0):(x(),g(n,{key:0,color:"primary",type:"submit",loading:o.loading.profile},{default:r(()=>e[12]||(e[12]=[p(" 更新資料 ")])),_:1},8,["loading"]))]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1}),o.profile.is_ad_user?A("",!0):(x(),g(c,{key:0,cols:"12",md:"8",lg:"6"},{default:r(()=>[a(P,null,{default:r(()=>[a(v,{class:"bg-primary text-white"},{default:r(()=>e[13]||(e[13]=[p(" 變更密碼 ")])),_:1}),a(U,{class:"pt-4"},{default:r(()=>[a(i,{ref:"passwordForm",onSubmit:S(o.updatePassword,["prevent"])},{default:r(()=>[a(s,{modelValue:o.passwords.current,"onUpdate:modelValue":e[5]||(e[5]=l=>o.passwords.current=l),label:"目前密碼",type:"password",variant:"outlined",rules:[l=>!!l||"請輸入目前密碼"],class:"mb-3"},null,8,["modelValue","rules"]),a(s,{modelValue:o.passwords.new,"onUpdate:modelValue":e[6]||(e[6]=l=>o.passwords.new=l),label:"新密碼",type:"password",variant:"outlined",rules:[l=>!!l||"請輸入新密碼"],class:"mb-3"},null,8,["modelValue","rules"]),a(s,{modelValue:o.passwords.confirm,"onUpdate:modelValue":e[7]||(e[7]=l=>o.passwords.confirm=l),label:"確認新密碼",type:"password",variant:"outlined",rules:[l=>!!l||"請確認新密碼",l=>l===o.passwords.new||"密碼不一致"],class:"mb-3"},null,8,["modelValue","rules"]),a(m,null,{default:r(()=>[a(t),a(n,{color:"primary",type:"submit",loading:o.loading.password},{default:r(()=>e[14]||(e[14]=[p(" 變更密碼 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1}))]),_:1}),a(C,{modelValue:o.snackbar.show,"onUpdate:modelValue":e[9]||(e[9]=l=>o.snackbar.show=l),color:o.snackbar.color,timeout:3e3},{actions:r(()=>[a(n,{variant:"text",onClick:e[8]||(e[8]=l=>o.snackbar.show=!1)},{default:r(()=>e[15]||(e[15]=[p(" 關閉 ")])),_:1})]),default:r(()=>[p(D(o.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}const E=N(j,[["render",T]]);export{E as default};
