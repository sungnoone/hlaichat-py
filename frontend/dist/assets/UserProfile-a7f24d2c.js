import{_ as B,r as b,j as V,o as L,a as d,b as y,c as x,w as r,d as g,e as l,f as D,g as p,n as S,p as C,t as M}from"./index-a1ba2a77.js";import{U as j}from"./UserLayout-c3bc48f7.js";const A={name:"UserProfile",components:{UserLayout:j},setup(){const f=b({username:"",full_name:"",email:"",phone:"",department:"",is_ad_user:!1}),e=V({current:"",new:"",confirm:""}),u=V({profile:!1,password:!1}),o=V({show:!1,text:"",color:"success"}),U=b(null),v=b(null),c=async()=>{try{const t=await g.get("/api/auth/me");if(t.data.user){const n=t.data.user;f.value={username:n.username,full_name:n.full_name,email:n.email||"",phone:n.phone||"",department:n.department||"",is_ad_user:n.is_ad_user}}}catch(t){console.error("獲取個人資料失敗:",t),s("獲取個人資料失敗","error")}},_=async()=>{var t,n;if(f.value.is_ad_user){s("AD帳號無法修改個人資料","warning");return}u.profile=!0;try{(await g.put("/api/users/profile",{phone:f.value.phone})).data.success&&s("個人資料更新成功")}catch(i){console.error("更新個人資料失敗:",i),s(((n=(t=i.response)==null?void 0:t.data)==null?void 0:n.detail)||"更新個人資料失敗","error")}finally{u.profile=!1}},w=async()=>{var n,i;const{valid:t}=await v.value.validate();if(t){u.password=!0;try{(await g.put("/api/users/password",{current_password:e.current,new_password:e.new})).data.success&&(s("密碼更新成功"),e.current="",e.new="",e.confirm="")}catch(m){console.error("更新密碼失敗:",m),s(((i=(n=m.response)==null?void 0:n.data)==null?void 0:i.detail)||"更新密碼失敗","error")}finally{u.password=!1}}},s=(t,n="success")=>{o.text=t,o.color=n,o.show=!0};return L(()=>{c()}),{profile:f,passwords:e,loading:u,snackbar:o,profileForm:U,passwordForm:v,updateProfile:_,updatePassword:w}}};function T(f,e,u,o,U,v){const c=d("v-col"),_=d("v-row"),w=d("v-card-title"),s=d("v-text-field"),t=d("v-spacer"),n=d("v-btn"),i=d("v-card-actions"),m=d("v-form"),k=d("v-card-text"),P=d("v-card"),F=d("v-snackbar"),N=d("UserLayout");return y(),x(N,null,{default:r(()=>[l(_,null,{default:r(()=>[l(c,{cols:"12"},{default:r(()=>e[10]||(e[10]=[D("h1",{class:"text-h4 mb-6"},"個人設定",-1)])),_:1})]),_:1}),l(_,null,{default:r(()=>[l(c,{cols:"12",md:"8",lg:"6"},{default:r(()=>[l(P,null,{default:r(()=>[l(w,{class:"bg-primary text-white"},{default:r(()=>e[11]||(e[11]=[p(" 個人資料 ")])),_:1}),l(k,{class:"pt-4"},{default:r(()=>[l(m,{ref:"profileForm",onSubmit:S(o.updateProfile,["prevent"])},{default:r(()=>[l(s,{modelValue:o.profile.username,"onUpdate:modelValue":e[0]||(e[0]=a=>o.profile.username=a),label:"使用者名稱",variant:"outlined",readonly:"",class:"mb-3"},null,8,["modelValue"]),l(s,{modelValue:o.profile.full_name,"onUpdate:modelValue":e[1]||(e[1]=a=>o.profile.full_name=a),label:"姓名",variant:"outlined",readonly:"",class:"mb-3"},null,8,["modelValue"]),l(s,{modelValue:o.profile.email,"onUpdate:modelValue":e[2]||(e[2]=a=>o.profile.email=a),label:"電子郵件",variant:"outlined",readonly:"",class:"mb-3"},null,8,["modelValue"]),l(s,{modelValue:o.profile.phone,"onUpdate:modelValue":e[3]||(e[3]=a=>o.profile.phone=a),label:"電話",variant:"outlined",readonly:o.profile.is_ad_user,class:"mb-3"},null,8,["modelValue","readonly"]),l(s,{modelValue:o.profile.department,"onUpdate:modelValue":e[4]||(e[4]=a=>o.profile.department=a),label:"部門",variant:"outlined",readonly:"",class:"mb-3"},null,8,["modelValue"]),l(i,null,{default:r(()=>[l(t),o.profile.is_ad_user?C("",!0):(y(),x(n,{key:0,color:"primary",type:"submit",loading:o.loading.profile},{default:r(()=>e[12]||(e[12]=[p(" 更新資料 ")])),_:1},8,["loading"]))]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1}),o.profile.is_ad_user?C("",!0):(y(),x(c,{key:0,cols:"12",md:"8",lg:"6"},{default:r(()=>[l(P,null,{default:r(()=>[l(w,{class:"bg-primary text-white"},{default:r(()=>e[13]||(e[13]=[p(" 變更密碼 ")])),_:1}),l(k,{class:"pt-4"},{default:r(()=>[l(m,{ref:"passwordForm",onSubmit:S(o.updatePassword,["prevent"])},{default:r(()=>[l(s,{modelValue:o.passwords.current,"onUpdate:modelValue":e[5]||(e[5]=a=>o.passwords.current=a),label:"目前密碼",type:"password",variant:"outlined",rules:[a=>!!a||"請輸入目前密碼"],class:"mb-3"},null,8,["modelValue","rules"]),l(s,{modelValue:o.passwords.new,"onUpdate:modelValue":e[6]||(e[6]=a=>o.passwords.new=a),label:"新密碼",type:"password",variant:"outlined",rules:[a=>!!a||"請輸入新密碼"],class:"mb-3"},null,8,["modelValue","rules"]),l(s,{modelValue:o.passwords.confirm,"onUpdate:modelValue":e[7]||(e[7]=a=>o.passwords.confirm=a),label:"確認新密碼",type:"password",variant:"outlined",rules:[a=>!!a||"請確認新密碼",a=>a===o.passwords.new||"密碼不一致"],class:"mb-3"},null,8,["modelValue","rules"]),l(i,null,{default:r(()=>[l(t),l(n,{color:"primary",type:"submit",loading:o.loading.password},{default:r(()=>e[14]||(e[14]=[p(" 變更密碼 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1}))]),_:1}),l(F,{modelValue:o.snackbar.show,"onUpdate:modelValue":e[9]||(e[9]=a=>o.snackbar.show=a),color:o.snackbar.color,timeout:3e3},{actions:r(()=>[l(n,{variant:"text",onClick:e[8]||(e[8]=a=>o.snackbar.show=!1)},{default:r(()=>e[15]||(e[15]=[p(" 關閉 ")])),_:1})]),default:r(()=>[p(M(o.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}const E=B(A,[["render",T]]);export{E as default};
